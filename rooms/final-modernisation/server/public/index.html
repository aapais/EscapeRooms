<!DOCTYPE html>
<html lang="en">
<head>
  <meta charset="UTF-8">
  <title>Legacy Dashboard (Final)</title>
  <style>
    body { font-family: -apple-system, BlinkMacSystemFont, "Segoe UI", Roboto, sans-serif; background: #1e1e1e; color: #fff; text-align: center; padding: 2rem; }
    .status-box { background: #333; padding: 2rem; border-radius: 12px; display: inline-block; min-width: 300px; }
    .indicator { font-size: 3rem; margin: 1rem 0; }
    .green { color: #4cd964; }
    .red { color: #ff3b30; }
    .btn { margin-top: 1rem; padding: 0.5rem 1rem; font-size: 1rem; cursor: pointer; }
  </style>
</head>
<body>
  <h1>ðŸš€ Legacy App Status</h1>
  
  <div class="status-box">
    <h3>System Health</h3>
    <div id="badge" class="indicator red">OFFLINE</div>
    <div id="details">Waiting for connection...</div>
    <button class="btn" onclick="checkHealth()">Refresh Status</button>
  </div>
  
  <hr style="border-color:#444; margin: 2rem 0;">

  <div class="status-box">
    <h3>Score Calculator (API)</h3>
    <button class="btn" onclick="calc()">Test Calculation</button>
    <div id="apiResult" style="margin-top:1rem; font-family:monospace;"></div>
  </div>

  <script>
    async function checkHealth() {
      const badge = document.getElementById('badge');
      const det = document.getElementById('details');
      
      try {
        const res = await fetch('/health');
        if (res.ok) {
            const data = await res.json();
            badge.textContent = "ONLINE";
            badge.className = "indicator green";
            det.textContent = "Uptime: " + data.uptime.toFixed(1) + "s";
        } else {
            throw new Error(res.statusText);
        }
      } catch (e) {
          badge.textContent = "OFFLINE";
          badge.className = "indicator red";
          det.textContent = "Error: " + e.message;
      }
    }

    async function calc() {
        try {
            const res = await fetch('/api/score', {
                method: 'POST',
                headers: {'Content-Type': 'application/json'},
                body: JSON.stringify({ age: 30, country: "PT", spends: [100, 200] })
            });
            const d = await res.json();
            document.getElementById('apiResult').textContent = JSON.stringify(d);
        } catch(e) {
            document.getElementById('apiResult').textContent = "API Error";
        }
    }

    // Auto check on load
    checkHealth();
  </script>
</body>
</html>
