<!DOCTYPE html>
<html lang="en">
<head>
  <meta charset="UTF-8">
  <meta name="viewport" content="width=device-width, initial-scale=1.0">
  <title>Invoice Admin (Room 2)</title>
  <style>
    body { font-family: sans-serif; max-width: 800px; margin: 2rem auto; padding: 1rem; }
    .cols { display: flex; gap: 1rem; }
    .col { flex: 1; }
    textarea { width: 100%; height: 150px; font-family: monospace; }
    .btn { background: #28a745; color: white; border: none; padding: 0.5rem 1rem; cursor: pointer; width: 100%; font-size: 1.1rem; }
    .btn:hover { background: #218838; }
    pre { background: #333; color: #fff; padding: 1rem; overflow-x: auto; border-radius: 4px; }
  </style>
</head>
<body>
  <h1>üè≠ Invoice Factory (Refactor Lab)</h1>
  <p>Goal: Refactor logic so it's clean (Complexity <= 10). The UI just shows the result.</p>

  <div class="cols">
    <div class="col">
      <h3>Input (Customer + Items)</h3>
      <textarea id="inputData">
{
  "customer": { 
      "name": "Big Corp", 
      "type": "VIP", 
      "country": "US" 
  },
  "items": [
      { "type": "SERVICE", "price": 500 },
      { "type": "PRODUCT", "price": 200 }
  ]
}
      </textarea>
      <br><br>
      <button class="btn" onclick="generate()">Generate Invoice ‚öôÔ∏è</button>
    </div>
    <div class="col">
      <h3>Result</h3>
      <div id="status">Ready</div>
      <pre id="output">...</pre>
    </div>
  </div>

  <script>
    async function generate() {
      const status = document.getElementById('status');
      const output = document.getElementById('output');
      
      status.textContent = "Processing...";
      status.style.color = "orange";
      
      try {
        const payload = JSON.parse(document.getElementById('inputData').value);
        
        const res = await fetch('/api/generate', {
            method: 'POST',
            headers: { 'Content-Type': 'application/json' },
            body: JSON.stringify(payload)
        });
        
        const data = await res.json();
        
        output.textContent = JSON.stringify(data, null, 2);
        status.innerHTML = `Done in <b>${data.meta.executionTimeMs}ms</b>`;
        status.style.color = "black";
        
      } catch (e) {
        status.textContent = "Error: " + e.message;
        status.style.color = "red";
      }
    }
  </script>
</body>
</html>
